2026-01-31 20:29:14 [INFO] root - Logging initialized. Log file: ./bubble_sam3_mask_20260131_202914.log
2026-01-31 20:29:14 [INFO] __main__ - ================================================================================
2026-01-31 20:29:14 [INFO] __main__ - SAM3 Bubble Segmentation Pipeline Started
2026-01-31 20:29:14 [INFO] __main__ - ================================================================================
2026-01-31 20:29:14 [INFO] __main__ - Input image: img6001.png
2026-01-31 20:29:14 [INFO] __main__ - Output path: imag6001_mask.png
2026-01-31 20:29:14 [INFO] __main__ - Config file: config.json
2026-01-31 20:29:14 [INFO] __main__ - Device: default
2026-01-31 20:29:14 [INFO] __main__ - Loading configuration...
2026-01-31 20:29:14 [DEBUG] __main__ - Configuration: {
  "device": "cuda",
  "seed": 0,
  "sam": {
    "confidence_threshold": 0.4,
    "use_fp16": true
  },
  "preprocess": {
    "enable_contrast_norm": true,
    "contrast_method": "clahe",
    "clahe_clip_limit": 0.03,
    "clahe_kernel_size": 64,
    "rescale_percentiles": [
      2,
      98
    ],
    "gamma": 1.0,
    "invert_gray": false
  },
  "candidates": {
    "enable_candidates": true,
    "method": "log+dog",
    "min_diameter_px": 10,
    "max_diameter_px": 200,
    "log_min_sigma": null,
    "log_max_sigma": null,
    "log_num_sigma": 10,
    "log_threshold": 0.02,
    "dog_min_sigma": null,
    "dog_max_sigma": null,
    "dog_sigma_ratio": 1.6,
    "dog_threshold": 0.02,
    "hough_dp": 1.2,
    "hough_minDist": 8,
    "hough_param1": 100,
    "hough_param2": 30,
    "hough_minRadius": null,
    "hough_maxRadius": null,
    "max_candidates_per_image": 2000,
    "dedup_centers": true,
    "dedup_radius_px": 4.0,
    "fallback_on_empty_candidates": true
  },
  "tiling": {
    "enable_tiling": true,
    "tile_size": 256,
    "tile_h": null,
    "tile_w": null,
    "tile_overlap": 64,
    "pad_mode": "reflect",
    "min_coverage_for_keep": 0.5
  },
  "hole_fill": {
    "enable_hole_fill": true,
    "hole_fill_method": "binary_fill_holes",
    "closing_radius": 2,
    "min_hole_area_px": 0,
    "fill_only_if_ringlike": false,
    "ringlike_threshold": 0.15
  },
  "postprocess": {
    "enable_consolidation": true,
    "iou_dedup_thresh": 0.5,
    "containment_thresh": 0.9,
    "min_area_px": 60,
    "max_area_fraction": 0.2,
    "border_exclusion_px": 1,
    "circularity_min": 0.0,
    "solidity_min": 0.0,
    "enable_convex_hull": false
  },
  "fallback": {
    "mode": "grid",
    "grid_spacing_px": 24,
    "grid_jitter_px": 0,
    "max_points": 4096
  },
  "output": {
    "output_mode": "cutout",
    "overlay_alpha": 128,
    "overlay_colormap": "tab20"
  },
  "debug": {
    "debug_dir": null
  }
}
2026-01-31 20:29:14 [INFO] __main__ - Setting random seed to 0
2026-01-31 20:29:14 [INFO] __main__ - Loading image from img6001.png
2026-01-31 20:29:14 [DEBUG] PIL.PngImagePlugin - STREAM b'IHDR' 16 13
2026-01-31 20:29:14 [DEBUG] PIL.PngImagePlugin - STREAM b'IDAT' 41 8192
2026-01-31 20:29:14 [INFO] __main__ - Image size: (1024, 1024)
2026-01-31 20:29:14 [INFO] __main__ - Running segmentation pipeline...
2026-01-31 20:29:14 [INFO] __main__ - Loading SAM3 model on cuda...
2026-01-31 20:29:18 [DEBUG] root - Falling back to triton or CPU mask NMS implementation -- please install `torch_generic_nms` via
	pip uninstall -y torch_generic_nms; TORCH_CUDA_ARCH_LIST="8.0 9.0" pip install git+https://github.com/ronghanghu/torch_generic_nms
2026-01-31 20:29:26 [DEBUG] httpcore.connection - connect_tcp.started host='huggingface.co' port=443 local_address=None timeout=10 socket_options=None
2026-01-31 20:29:26 [DEBUG] httpcore.connection - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f242c589640>
2026-01-31 20:29:26 [DEBUG] httpcore.connection - start_tls.started ssl_context=<ssl.SSLContext object at 0x7f2375913350> server_hostname='huggingface.co' timeout=10
2026-01-31 20:29:26 [DEBUG] httpcore.connection - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f23758f6f00>
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - send_request_headers.started request=<Request [b'HEAD']>
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - send_request_headers.complete
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - send_request_body.started request=<Request [b'HEAD']>
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - send_request_body.complete
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - receive_response_headers.started request=<Request [b'HEAD']>
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'text/plain; charset=utf-8'), (b'Content-Length', b'25843'), (b'Connection', b'keep-alive'), (b'Date', b'Sun, 01 Feb 2026 01:29:26 GMT'), (b'ETag', b'"3e600e765b0f1b4c52680aed9ad242c9a90f7ed1"'), (b'X-Powered-By', b'huggingface-moon'), (b'X-Request-Id', b'Root=1-697eac76-2d68c5812bec80e733144641;cc894935-27fb-4ce4-a7f7-42cf16d11564'), (b'RateLimit', b'"resolvers";r=4999;t=37'), (b'RateLimit-Policy', b'"fixed window";"resolvers";q=5000;w=300'), (b'cross-origin-opener-policy', b'same-origin'), (b'Referrer-Policy', b'strict-origin-when-cross-origin'), (b'Access-Control-Max-Age', b'86400'), (b'Access-Control-Allow-Origin', b'https://huggingface.co'), (b'Vary', b'Origin'), (b'Access-Control-Expose-Headers', b'X-Repo-Commit,X-Request-Id,X-Error-Code,X-Error-Message,X-Total-Count,ETag,Link,Accept-Ranges,Content-Range,X-Linked-Size,X-Linked-ETag,X-Xet-Hash'), (b'X-Repo-Commit', b'3c879f39826c281e95690f02c7821c4de09afae7'), (b'Accept-Ranges', b'bytes'), (b'X-Hub-Cache', b'HIT'), (b'Content-Disposition', b'inline; filename*=UTF-8\'\'config.json; filename="config.json";'), (b'Content-Security-Policy', b"default-src 'none'; sandbox"), (b'X-Cache', b'Miss from cloudfront'), (b'Via', b'1.1 6f6a74f12dc7de2c455092348b6c9f28.cloudfront.net (CloudFront)'), (b'X-Amz-Cf-Pop', b'JFK50-P9'), (b'X-Amz-Cf-Id', b'PfPq6bfPL8XwIOzRRlFNGyMEx-oFbFAkSKg335Q_cAwe-NcBrAKe2w==')])
2026-01-31 20:29:26 [INFO] httpx - HTTP Request: HEAD https://huggingface.co/facebook/sam3/resolve/main/config.json "HTTP/1.1 200 OK"
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - receive_response_body.started request=<Request [b'HEAD']>
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - receive_response_body.complete
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - response_closed.started
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - response_closed.complete
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - send_request_headers.started request=<Request [b'HEAD']>
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - send_request_headers.complete
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - send_request_body.started request=<Request [b'HEAD']>
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - send_request_body.complete
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - receive_response_headers.started request=<Request [b'HEAD']>
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - receive_response_headers.complete return_value=(b'HTTP/1.1', 302, b'Found', [(b'Content-Type', b'text/plain; charset=utf-8'), (b'Content-Length', b'1323'), (b'Connection', b'keep-alive'), (b'Date', b'Sun, 01 Feb 2026 01:29:26 GMT'), (b'Location', b'https://cas-bridge.xethub.hf.co/xet-bridge-us/690d80fc9f252aa897a1dc6d/ba62acd04c1fe8f3d6096b1552e6ca28a2f7c7380f931040f5719a2bcdf844ad?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=cas%2F20260201%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260201T011527Z&X-Amz-Expires=3600&X-Amz-Signature=276d0d5fddc2c78660e7c5680207401ade9dca19508a25765d4deaf4d3fa591f&X-Amz-SignedHeaders=host&X-Xet-Cas-Uid=651de2f199c340941837cf42&response-content-disposition=inline%3B+filename*%3DUTF-8%27%27sam3.pt%3B+filename%3D%22sam3.pt%22%3B&x-id=GetObject&Expires=1769912127&Policy=eyJTdGF0ZW1lbnQiOlt7IkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTc2OTkxMjEyN319LCJSZXNvdXJjZSI6Imh0dHBzOi8vY2FzLWJyaWRnZS54ZXRodWIuaGYuY28veGV0LWJyaWRnZS11cy82OTBkODBmYzlmMjUyYWE4OTdhMWRjNmQvYmE2MmFjZDA0YzFmZThmM2Q2MDk2YjE1NTJlNmNhMjhhMmY3YzczODBmOTMxMDQwZjU3MTlhMmJjZGY4NDRhZCoifV19&Signature=cWz3P0KT6Gjyb-ATLJ4Fme2dbps7qoZQ0p3IQFJkZ7WKmjkXLuluyOoAda-YJvPqipwH3Ge%7EBaYSBF9Eo512jkGI090z42lr%7E%7E8X4Qocxxe5twDgeWU5N4rA0M4F0pFoFn7J2Vrzu8McS7vTMBLyY1gGoCzSlQifqcxlUeJjMfNJ1qQtA9IiHQsmfr-xjFSpFUjujye4XFvpnQtd1giBIkZisjdB09D5YWPWX%7Eh3rz0FXODprX6ZQq7ALUtvpbOLmb9%7EwIJ6sVkHfudWUB%7Ei2TZ49ACfwdt20HOlLiSOrn1tRvjYSwjYGJyZDCeA-Ed7DmhB%7ENaAazJOUPO0XWCrow__&Key-Pair-Id=K2L8F4GPSG1IFC'), (b'X-Powered-By', b'huggingface-moon'), (b'X-Request-Id', b'Root=1-697eac76-5b4432262cd01541273b2ed9;5930b427-32f3-4e2c-96ef-b29d4838036c'), (b'RateLimit', b'"resolvers";r=4998;t=37'), (b'RateLimit-Policy', b'"fixed window";"resolvers";q=5000;w=300'), (b'cross-origin-opener-policy', b'same-origin'), (b'Referrer-Policy', b'strict-origin-when-cross-origin'), (b'Access-Control-Max-Age', b'86400'), (b'Access-Control-Allow-Origin', b'https://huggingface.co'), (b'Vary', b'Origin, Accept'), (b'Access-Control-Expose-Headers', b'X-Repo-Commit,X-Request-Id,X-Error-Code,X-Error-Message,X-Total-Count,ETag,Link,Accept-Ranges,Content-Range,X-Linked-Size,X-Linked-ETag,X-Xet-Hash'), (b'X-Repo-Commit', b'3c879f39826c281e95690f02c7821c4de09afae7'), (b'Accept-Ranges', b'bytes'), (b'X-Hub-Cache', b'HIT'), (b'X-Linked-Size', b'3450062241'), (b'X-Linked-ETag', b'"9999e2341ceef5e136daa386eecb55cb414446a00ac2b55eb2dfd2f7c3cf8c9e"'), (b'X-Xet-Hash', b'ba62acd04c1fe8f3d6096b1552e6ca28a2f7c7380f931040f5719a2bcdf844ad'), (b'Link', b'<https://huggingface.co/api/models/facebook/sam3/xet-read-token/3c879f39826c281e95690f02c7821c4de09afae7>; rel="xet-auth", <https://cas-server.xethub.hf.co/v1/reconstructions/ba62acd04c1fe8f3d6096b1552e6ca28a2f7c7380f931040f5719a2bcdf844ad>; rel="xet-reconstruction-info"'), (b'X-Cache', b'Miss from cloudfront'), (b'Via', b'1.1 6f6a74f12dc7de2c455092348b6c9f28.cloudfront.net (CloudFront)'), (b'X-Amz-Cf-Pop', b'JFK50-P9'), (b'X-Amz-Cf-Id', b'KsjN4PfSIBwsSeO3Ecy5PTopRShtpbdr-RsqRB9xQDXkAS5rQc2r6w==')])
2026-01-31 20:29:26 [INFO] httpx - HTTP Request: HEAD https://huggingface.co/facebook/sam3/resolve/main/sam3.pt "HTTP/1.1 302 Found"
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - receive_response_body.started request=<Request [b'HEAD']>
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - receive_response_body.complete
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - response_closed.started
2026-01-31 20:29:26 [DEBUG] httpcore.http11 - response_closed.complete
2026-01-31 20:29:28 [INFO] __main__ - SAM3 model loaded successfully.
2026-01-31 20:29:28 [INFO] __main__ - Image preprocessed. Shape: (1024, 1024)
2026-01-31 20:29:28 [INFO] __main__ - Tiling enabled. Creating tile grid...
2026-01-31 20:29:28 [INFO] __main__ - Created 25 tiles with padding bottom=0, right=0
2026-01-31 20:29:28 [DEBUG] __main__ - Processing tile 1/25: (0, 0) to (256, 256)
2026-01-31 20:29:32 [DEBUG] __main__ -   Tile 1: Found 105 candidate points
2026-01-31 20:29:33 [DEBUG] httpcore.connection - close.started
2026-01-31 20:29:33 [DEBUG] httpcore.connection - close.complete
