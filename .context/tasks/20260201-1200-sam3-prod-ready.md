# Task: Make bubble_sam3_mask.py production ready

- status: open
- owner: codex/20260201-1200
- branch: main
- created: 2026-02-01

## Plan
- (pending) Review current bubble_sam3_mask.py and test2.py usage patterns
- (pending) Replace SAM3 point prompting with documented Sam3Tracker path + batching
- (pending) Add production outputs (per-instance stats + JSON) and performance fixes
- (pending) Validate CLI/config wiring and update docs/comments

## Log
- 2026-02-01: Task created and claimed by codex/20260201-1200.

## Messages
- None

## Log
- 2026-02-01: Refactored SAM3 backend to use transformers Sam3Tracker with point batching and OOM retry.
- 2026-02-01: Switched instance storage to bbox-local masks, updated IoU/containment logic, and added per-instance JSON/CSV outputs.
- 2026-02-01: Added output path helpers, RLE export option, and updated docs/CLI/config for new SAM3/output options.
- 2026-02-01: Fixed Sam3Tracker input point tensor shape to 4D and added local-cache preference with optional download fallback.
- 2026-02-01: Fixed tensor truthiness bug when selecting SAM3 tracker scores by using explicit None checks.
- 2026-02-01: Added JSONC support to config loader and created commented config.jsonc template.
- 2026-02-01: Modularized bubble_sam3_mask.py into bubble_sam3 package (config, backend, candidates, preprocess, tiling, postprocess, outputs, pipeline) and updated entrypoint.
